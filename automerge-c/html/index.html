<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>automerge-c: Methods we need to support</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="brandmark.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">automerge-c
   &#160;<span id="projectnumber">0.1.0</span>
   </div>
   <div id="projectbrief">C bindings for the Automerge Rust backend.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Methods we need to support </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="autotoc_md78"></a>
Basic management</h2>
<ol type="1">
<li><code><a class="el" href="structAMdoc.html#a0be75204f0f27936559fcda7b9534314" title="Allocates a new document and initializes it with defaults.">AMcreate()</a></code></li>
</ol>
<ol type="1">
<li><code>AMclone(doc)</code></li>
</ol>
<ol type="1">
<li><code>AMfree(doc)</code></li>
</ol>
<ol type="1">
<li><code>AMconfig(doc, key, val)</code> // set actor</li>
</ol>
<ol type="1">
<li><code>actor = get_actor(doc)</code></li>
</ol>
<h2><a class="anchor" id="autotoc_md79"></a>
Transactions</h2>
<ol type="1">
<li><code>AMpendingOps(doc)</code></li>
</ol>
<ol type="1">
<li><code>AMcommit(doc, message, time)</code></li>
</ol>
<ol type="1">
<li><code>AMrollback(doc)</code></li>
</ol>
<h2><a class="anchor" id="autotoc_md80"></a>
Write</h2>
<ol type="1">
<li><code>AMset{Map|List}(doc, obj, prop, value)</code></li>
</ol>
<ol type="1">
<li><code>AMinsert(doc, obj, index, value)</code></li>
</ol>
<ol type="1">
<li><code>AMpush(doc, obj, value)</code></li>
</ol>
<ol type="1">
<li><code>AMdel{Map|List}(doc, obj, prop)</code></li>
</ol>
<ol type="1">
<li><code>AMinc{Map|List}(doc, obj, prop, value)</code></li>
</ol>
<ol type="1">
<li><code>AMspliceText(doc, obj, start, num_del, text)</code></li>
</ol>
<h2><a class="anchor" id="autotoc_md81"></a>
Read</h2>
<ol type="1">
<li><code>AMkeys(doc, obj, heads)</code></li>
</ol>
<ol type="1">
<li><code>AMlength(doc, obj, heads)</code></li>
</ol>
<ol type="1">
<li><code>AMvalues(doc, obj, heads)</code></li>
</ol>
<ol type="1">
<li><code>AMtext(doc, obj, heads)</code></li>
</ol>
<h2><a class="anchor" id="autotoc_md82"></a>
Sync</h2>
<ol type="1">
<li><code>AMgenerateSyncMessage(doc, state)</code></li>
</ol>
<ol type="1">
<li><code>AMreceiveSyncMessage(doc, state, message)</code></li>
</ol>
<ol type="1">
<li><code>AMinitSyncState()</code></li>
</ol>
<h2><a class="anchor" id="autotoc_md83"></a>
Save / Load</h2>
<ol type="1">
<li><code>AMload(data)</code></li>
</ol>
<ol type="1">
<li><code>AMloadIncremental(doc, data)</code></li>
</ol>
<ol type="1">
<li><code>AMsave(doc)</code></li>
</ol>
<ol type="1">
<li><code>AMsaveIncremental(doc)</code></li>
</ol>
<h2><a class="anchor" id="autotoc_md84"></a>
Low Level Access</h2>
<ol type="1">
<li><code>AMapplyChanges(doc, changes)</code></li>
</ol>
<ol type="1">
<li><code>AMgetChanges(doc, deps)</code></li>
</ol>
<ol type="1">
<li><code>AMgetChangesAdded(doc1, doc2)</code></li>
</ol>
<ol type="1">
<li><code>AMgetHeads(doc)</code></li>
</ol>
<ol type="1">
<li><code>AMgetLastLocalChange(doc)</code></li>
</ol>
<ol type="1">
<li><code>AMgetMissingDeps(doc, heads)</code></li>
</ol>
<h2><a class="anchor" id="autotoc_md85"></a>
Encode/Decode</h2>
<ol type="1">
<li><code>AMencodeChange(change)</code></li>
</ol>
<ol type="1">
<li><code>AMdecodeChange(change)</code></li>
</ol>
<ol type="1">
<li><code>AMencodeSyncMessage(change)</code></li>
</ol>
<ol type="1">
<li><code>AMdecodeSyncMessage(change)</code></li>
</ol>
<ol type="1">
<li><code>AMencodeSyncState(change)</code></li>
</ol>
<ol type="1">
<li><code>AMdecodeSyncState(change)</code></li>
</ol>
<h1><a class="anchor" id="autotoc_md86"></a>
Open Question - Memory management</h1>
<p>Most of these calls return one or more items of arbitrary length. Doing memory management in C is tricky. This is my proposed solution...</p>
<h2><a class="anchor" id="autotoc_md87"></a>
autotoc_md87</h2>
<div class="fragment"><div class="line">// returns 1 or zero opids</div>
<div class="line">n = automerge_set(doc, &quot;_root&quot;, &quot;hello&quot;, datatype, value);</div>
<div class="line">if (n) {</div>
<div class="line">  automerge_pop(doc, &amp;obj, len);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// returns n values</div>
<div class="line">n = automerge_values(doc, &quot;_root&quot;, &quot;hello&quot;);</div>
<div class="line">for (i = 0; i&lt;n ;i ++) {</div>
<div class="line">  automerge_pop_value(doc, &amp;value, &amp;datatype, len);</div>
<div class="line">}</div>
</div><!-- fragment --><p>There would be one pop method per object type. Users allocs and frees the buffers. Multiple return values would result in multiple pops. Too small buffers would error and allow retry.</p>
<h2><a class="anchor" id="autotoc_md88"></a>
Formats</h2>
<p>Actors - We could do (bytes,len) or a hex encoded string?. <br  />
 ObjIds - We could do flat bytes of the ExId struct but lets do human readable strings for now - the struct would be faster but opque Heads - Might as well make it a flat buffer <code>(n, hash, hash, ...)</code> Changes - Put them all in a flat concatenated buffer Encode/Decode - to json strings? </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
